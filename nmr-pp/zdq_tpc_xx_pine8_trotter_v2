; zdq_tpc_xx_pine8_trotter_v2
; 26 May 2022
; ZZ TPC Experiment for effective H = g*Z + J*DQ
; Hamiltonian engineered by Pine8 Sequence and Trotter with virtual Z pulse
; theta = 3/6/12/50 deg
; Andrew Stasiuk

#include <Avance.incl>

; define the delays for Ken16
; p1 should be length of a 90 deg pulse (~ 1 us)

define delay tau0
"tau0 = (d2 - p1)/2"
define delay tau1
"tau1 = d2  - p1"
define delay tau2
"tau2 = 2 * d2 - p1"

; This delay is the length of the entire Ham Eng Cycle
; It is given by 12*d2, d2 should be  ~ 5 us.
define delay cycle
"cycle=12*d2"

; First measurement length.
; Measurements occur at intervals of cycle*(x+l1), x=0,...,td1
"l1=0"

; start the pulse program
1   ze

; state-reset delay, reset phase program for next scan
2   d1 rpp10
    ; set the power level of a 90 deg pulse to be pl1 on channel 2 (assuming pulse p1)
    cycle pl1:f2
    ; change state to X(t)
    (p1 ph29):f2

; Ken16 Hamiltonian engineering
3
    tau1
    (p1 ph10^):f2
    tau2
    (p1 ph10^):f2
    tau1
    (p1 ph10^):f2
    tau2
    (p1 ph10^):f2
    tau1
    (p1 ph10^):f2
    tau2
    (p1 ph10^):f2
    tau1
    (p1 ph10^):f2
    tau2
    (p1 ph10^):f2

    lo to 3 times l1

    ; store in Z and kill transients, measure in X
    2.5u
    (p1 ph11^):f2
    1m
    (p1 ph30):f2

    go=2 ph31

    1m wr #0 if #0

    ; increase evolution time by 1 cycle length, and re-scan
    1m iu1
    lo to 2 times td1

    exit


; Pine8 phase programs
; ham eng
;3 deg
;ph10 = (360) 0 0 180 180 180 180 0 0 357 357 177 177 177 177 357 357 354 354 174 174 174 174 354 354 351 351 171 171 171 171 351 351 348 348 168 168 168 168 348 348 345 345 165 165 165 165 345 345 342 342 162 162 162 162 342 342 339 339 159 159 159 159 339 339 336 336 156 156 156 156 336 336 333 333 153 153 153 153 333 333 330 330 150 150 150 150 330 330 327 327 147 147 147 147 327 327 324 324 144 144 144 144 324 324 321 321 141 141 141 141 321 321 318 318 138 138 138 138 318 318 315 315 135 135 135 135 315 315
;6 deg
;ph10 = (360) 0 0 180 180 180 180 0 0 354 354 174 174 174 174 354 354 348 348 168 168 168 168 348 348 342 342 162 162 162 162 342 342 336 336 156 156 156 156 336 336 330 330 150 150 150 150 330 330 324 324 144 144 144 144 324 324 318 318 138 138 138 138 318 318 312 312 132 132 132 132 312 312 306 306 126 126 126 126 306 306 300 300 120 120 120 120 300 300 294 294 114 114 114 114 294 294 288 288 108 108 108 108 288 288 282 282 102 102 102 102 282 282 276 276 96 96 96 96 276 276 270 270 90 90 90 90 270 270
; 12 deg
ph10 = (360) 0 0 180 180 180 180 0 0 348 348 168 168 168 168 348 348 336 336 156 156 156 156 336 336 324 324 144 144 144 144 324 324 312 312 132 132 132 132 312 312 300 300 120 120 120 120 300 300 288 288 108 108 108 108 288 288 276 276 96 96 96 96 276 276 264 264 84 84 84 84 264 264 252 252 72 72 72 72 252 252 240 240 60 60 60 60 240 240 228 228 48 48 48 48 228 228 216 216 36 36 36 36 216 216 204 204 24 24 24 24 204 204 192 192 12 12 12 12 192 192 180 180 0 0 0 0 180 180

; final X pulse before 1ms delay
;3 deg
;ph11 = (360) 270 90 90 270 267 87 87 267 264 84 84 264 261 81 81 261 258 78 78 258 255 75 75 255 252 72 72 252 249 69 69 249 246 66 66 246 243 63 63 243 240 60 60 240 237 57 57 237 234 54 54 234 231 51 51 231 228 48 48 228 225 45 45 225 222 42 42 222
;6 deg
;ph11 = (360) 270 90 90 270 264 84 84 264 258 78 78 258 252 72 72 252 246 66 66 246 240 60 60 240 234 54 54 234 228 48 48 228 222 42 42 222 216 36 36 216 210 30 30 210 204 24 24 204 198 18 18 198 192 12 12 192 186 6 6 186 180 0 0 180 174 354 354 174
;12 deg
ph11 = (360) 270 90 90 270 258 78 78 258 246 66 66 246 234 54 54 234 222 42 42 222 210 30 30 210 198 18 18 198 186 6 6 186 174 354 354 174 162 342 342 162 150 330 330 150 138 318 318 138 126 306 306 126 114 294 294 114 102 282 282 102 90 270 270 90 78 258 258 78

; final pulse phase program
ph29 = 1 3 3 1
ph30 = 1 3 3 1
ph31 = 0 2 2 0
